<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Passagem de Plant√£o de Enfermagem</title>
    
    <!-- Tailwind CSS for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- jsPDF for PDF generation -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    
    <!-- jsPDF-AutoTable plugin for creating tables in PDF -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.23/jspdf.plugin.autotable.min.js"></script>

    <!-- Google Fonts: Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <style>
        /* Custom styles to enhance the UI */
        body {
            font-family: 'Inter', sans-serif;
        }
        /* Style for active status button */
        .status-btn.active {
            transform: scale(1.05);
            box-shadow: 0 0 0 2px white, 0 0 0 4px currentColor;
        }
        /* Custom scrollbar for better aesthetics */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
        }
        ::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #555;
        }
    </style>
</head>
<body class="bg-gray-100 text-gray-800">

    <div class="container mx-auto max-w-4xl p-4 sm:p-6 lg:p-8">
        
        <!-- Header Section -->
        <header class="text-center mb-8">
            <h1 class="text-3xl sm:text-4xl font-bold text-blue-800">Passagem de Plant√£o de Enfermagem</h1>
            <p class="text-gray-600 mt-2">Checklist de verifica√ß√£o de ambientes e materiais</p>
        </header>

        <main id="checklist-form" class="bg-white p-6 sm:p-8 rounded-2xl shadow-lg space-y-8">
            
            <!-- General Information Section -->
            <section class="border-b pb-6">
                <h2 class="text-xl font-semibold text-gray-700 mb-4">Informa√ß√µes Gerais</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <input type="text" id="enfermeiro-saida" placeholder="Enfermeiro(a) do plant√£o (sa√≠da)" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition">
                    <input type="text" id="enfermeiro-entrada" placeholder="Enfermeiro(a) do plant√£o (entrada)" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition">
                    <input type="date" id="data-plantao" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition" title="Data do Plant√£o">
                    <select id="turno-plantao" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition">
                        <option value="Manh√£">Manh√£</option>
                        <option value="Tarde">Tarde</option>
                        <option value="Noite">Noite</option>
                    </select>
                </div>
            </section>

            <!-- Checklist Sections -->
            <div id="salas-container" class="space-y-6">
                <!-- Sections will be dynamically generated by JavaScript -->
            </div>

            <!-- Action Buttons -->
            <div class="flex flex-col sm:flex-row gap-4 pt-6 border-t mt-8">
                <button id="generate-pdf-btn" class="w-full bg-blue-600 text-white font-bold py-3 px-6 rounded-lg hover:bg-blue-700 focus:outline-none focus:ring-4 focus:ring-blue-300 transition-transform transform hover:scale-105 duration-300 ease-in-out flex items-center justify-center gap-2">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" /></svg>
                    Gerar Relat√≥rio PDF
                </button>
                <button id="reset-form-btn" class="w-full sm:w-auto bg-gray-200 text-gray-700 font-bold py-3 px-6 rounded-lg hover:bg-gray-300 focus:outline-none focus:ring-4 focus:ring-gray-300 transition duration-300">
                    Limpar Tudo
                </button>
            </div>

        </main>
        
        <!-- Footer -->
        <footer class="text-center mt-8 text-gray-500 text-sm">
            <p>&copy; <span id="current-year"></span> Sistema de Passagem de Plant√£o. Todos os direitos reservados.</p>
        </footer>
    </div>

    <script>
        // Data for the checklist sections and items
        const checklistData = [
            {
                id: 'ambulatorio',
                title: 'Sala de Ambulat√≥rio',
                icon: 'üè•',
                items: [
                    'Organiza√ß√£o', 'Arm√°rio de medicamentos', 'Caixa de Descarpak', 'Aparelho de Press√£o', 'Term√¥metro', 'Ox√≠metro', 'Balan√ßa', 'Geladeira para medicamentos', 'Torpedo de Oxig√™nio'
                ]
            },
            {
                id: 'curativos',
                title: 'Sala de Curativos',
                icon: 'ü©π',
                items: [
                    'Organiza√ß√£o', 'Arm√°rio de materiais (gazes, ataduras, etc.)', 'Caixa de Descarpak'
                ]
            },
            {
                id: 'vacinas',
                title: 'Sala de Vacinas',
                icon: 'üíâ',
                items: [
                    'Organiza√ß√£o', 'Geladeira para conservar as vacinas', 'Estoque de Vacinas', 'Caixa de Descarpak'
                ]
            },
            {
                id: 'esterilizacao',
                title: 'Sala de Esteriliza√ß√£o',
                icon: 'üî¨',
                items: [
                    'Organiza√ß√£o', 'Autoclave 01', 'Autoclave 02', 'Autoclave 03', 'Materiais esterilizados', 'Materiais n√£o esterilizados', 'Instrumental cir√∫rgico'
                ]
            },
            {
                id: 'expurgo',
                title: 'Sala de Expurgo',
                icon: 'üßº',
                items: [
                    'Organiza√ß√£o', 'Pia de descarte e limpeza', 'Caixa de Descarpak'
                ]
            }
        ];

        // Function to create and render the checklist sections
        function renderChecklist() {
            const container = document.getElementById('salas-container');
            container.innerHTML = ''; // Clear previous content

            checklistData.forEach(sala => {
                const section = document.createElement('section');
                section.id = `section-${sala.id}`;
                section.className = 'border p-4 sm:p-6 rounded-xl shadow-sm transition-all duration-300';
                
                let itemsHtml = sala.items.map((item, index) => {
                    const itemId = `${sala.id}-item-${index}`;
                    return `
                        <div class="grid grid-cols-1 sm:grid-cols-3 gap-4 items-center py-3 border-t first:border-t-0">
                            <label for="${itemId}-obs" class="font-medium text-gray-700">${item}</label>
                            <div class="flex gap-2" data-item-id="${itemId}">
                                <button type="button" data-status="Conforme" class="status-btn flex-1 text-sm bg-green-100 text-green-800 p-2 rounded-md hover:bg-green-200 transition font-semibold">Conforme</button>
                                <button type="button" data-status="Pendente" class="status-btn flex-1 text-sm bg-yellow-100 text-yellow-800 p-2 rounded-md hover:bg-yellow-200 transition font-semibold">Pendente</button>
                                <button type="button" data-status="N/A" class="status-btn flex-1 text-sm bg-gray-100 text-gray-800 p-2 rounded-md hover:bg-gray-200 transition font-semibold">N/A</button>
                            </div>
                            <input type="text" id="${itemId}-obs" placeholder="Observa√ß√µes..." class="w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition">
                        </div>
                    `;
                }).join('');

                section.innerHTML = `
                    <h3 class="text-lg font-semibold text-blue-700 mb-4 flex items-center gap-2">
                        <span class="text-2xl">${sala.icon}</span>
                        ${sala.title}
                    </h3>
                    <div class="space-y-2">
                        ${itemsHtml}
                    </div>
                `;
                container.appendChild(section);
            });

            // Add event listeners to the newly created status buttons
            addStatusButtonListeners();
        }

        // Function to handle clicks on status buttons
        function addStatusButtonListeners() {
            const statusButtons = document.querySelectorAll('.status-btn');
            statusButtons.forEach(button => {
                button.addEventListener('click', () => {
                    // Find sibling buttons within the same group and remove 'active' class
                    const parent = button.parentElement;
                    parent.querySelectorAll('.status-btn').forEach(btn => {
                        btn.classList.remove('active', 'bg-green-500', 'text-white', 'bg-yellow-500', 'bg-gray-500');
                        // Reset to default styles
                        if (btn.dataset.status === 'Conforme') btn.classList.add('bg-green-100', 'text-green-800');
                        if (btn.dataset.status === 'Pendente') btn.classList.add('bg-yellow-100', 'text-yellow-800');
                        if (btn.dataset.status === 'N/A') btn.classList.add('bg-gray-100', 'text-gray-800');
                    });
                    
                    // Add 'active' class and active styles to the clicked button
                    button.classList.add('active');
                    if (button.dataset.status === 'Conforme') button.classList.add('bg-green-500', 'text-white');
                    if (button.dataset.status === 'Pendente') button.classList.add('bg-yellow-500', 'text-white');
                    if (button.dataset.status === 'N/A') button.classList.add('bg-gray-500', 'text-white');
                });
            });
        }

        // Function to generate the PDF report
        function generatePDF() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF({
                orientation: 'portrait',
                unit: 'mm',
                format: 'a4'
            });

            // --- Document Header ---
            const enfermeiroSaida = document.getElementById('enfermeiro-saida').value || 'N√£o informado';
            const enfermeiroEntrada = document.getElementById('enfermeiro-entrada').value || 'N√£o informado';
            const dataPlantao = document.getElementById('data-plantao').value ? new Date(document.getElementById('data-plantao').value + 'T00:00:00').toLocaleDateString('pt-BR') : 'N√£o informada';
            const turnoPlantao = document.getElementById('turno-plantao').value;
            const generationTime = new Date().toLocaleString('pt-BR', { dateStyle: 'short', timeStyle: 'medium' });

            doc.setFontSize(18);
            doc.setFont('helvetica', 'bold');
            doc.text('Relat√≥rio de Passagem de Plant√£o', doc.internal.pageSize.getWidth() / 2, 20, { align: 'center' });

            doc.setFontSize(11);
            doc.setFont('helvetica', 'normal');
            doc.text(`Data do Plant√£o: ${dataPlantao}`, 15, 35);
            doc.text(`Turno: ${turnoPlantao}`, 15, 42);
            doc.text(`Enfermeiro(a) (Sa√≠da): ${enfermeiroSaida}`, 15, 49);
            doc.text(`Enfermeiro(a) (Entrada): ${enfermeiroEntrada}`, 15, 56);
            doc.text(`Relat√≥rio gerado em: ${generationTime}`, 15, 63); // Added generation timestamp

            let finalY = 70; // Adjusted initial Y position for the first table

            // --- Checklist Data for PDF ---
            checklistData.forEach(sala => {
                const head = [['Item', 'Status', 'Observa√ß√µes']];
                const body = [];

                sala.items.forEach((item, index) => {
                    const itemId = `${sala.id}-item-${index}`;
                    const statusButton = document.querySelector(`[data-item-id="${itemId}"] .status-btn.active`);
                    const status = statusButton ? statusButton.dataset.status : 'N√£o preenchido';
                    const observacao = document.getElementById(`${itemId}-obs`).value || '-';
                    body.push([item, status, observacao]);
                });

                // Add a title for the section
                doc.setFontSize(14);
                doc.setFont('helvetica', 'bold');
                doc.text(`${sala.icon} ${sala.title}`, 14, finalY);
                finalY += 7;

                // Create the table for the section
                doc.autoTable({
                    startY: finalY,
                    head: head,
                    body: body,
                    theme: 'grid',
                    headStyles: {
                        fillColor: [22, 160, 133], // A nice teal color for the header
                        textColor: 255,
                        fontStyle: 'bold'
                    },
                    columnStyles: {
                        0: { cellWidth: 60 },
                        1: { cellWidth: 30 },
                        2: { cellWidth: 'auto' }
                    },
                    didDrawPage: (data) => {
                        finalY = data.cursor.y; // Update Y position after table is drawn
                    }
                });
                finalY = doc.autoTable.previous.finalY + 10; // Add margin for the next section
            });
            
            // --- Footer with Signature Lines ---
            const pageHeight = doc.internal.pageSize.getHeight();
            const signatureY = pageHeight - 30; // Position signatures near the bottom
            if (finalY > signatureY - 10) { // Add new page if content is too close to bottom
                doc.addPage();
                finalY = 20;
            } else {
                finalY = signatureY;
            }
            
            doc.setFontSize(10);
            doc.text('_________________________________________', 20, finalY + 5);
            doc.text(enfermeiroSaida, 20, finalY + 10);
            doc.text('Assinatura (Sa√≠da)', 20, finalY + 15);

            doc.text('_________________________________________', 110, finalY + 5);
            doc.text(enfermeiroEntrada, 110, finalY + 10);
            doc.text('Assinatura (Entrada)', 110, finalY + 15);


            // Save the PDF
            const date = new Date().toISOString().slice(0, 10);
            doc.save(`passagem-plantao-${date}.pdf`);
        }
        
        // Function to reset the form
        function resetForm() {
            if (confirm('Tem certeza que deseja limpar todos os campos preenchidos?')) {
                document.getElementById('checklist-form').reset();
                // Re-render to clear button states
                renderChecklist();
                // Set date to today after reset
                document.getElementById('data-plantao').valueAsDate = new Date();
            }
        }

        // --- Initial Setup ---
        document.addEventListener('DOMContentLoaded', () => {
            // Set current year in footer
            document.getElementById('current-year').textContent = new Date().getFullYear();
            
            // Set current date in the date input
            document.getElementById('data-plantao').valueAsDate = new Date();
            
            // Render the initial checklist
            renderChecklist();

            // Attach event listeners to main buttons
            document.getElementById('generate-pdf-btn').addEventListener('click', generatePDF);
            document.getElementById('reset-form-btn').addEventListener('click', resetForm);
        });
    </script>
</body>
</html>
